<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gestione Libri</title>
<style>
body { font-family: Arial; padding: 20px; text-align: center; }
input, button { width: 90%; padding: 10px; margin:5px 0; font-size: 18px; border-radius: 8px; border:1px solid #888; }
#result { font-size: 18px; padding: 15px; text-align: left; white-space: pre-line; max-width: 500px; margin:auto;}
.bookList { text-align: left; max-width: 500px; margin:auto; margin-top: 20px;}
.bookItem { border-bottom: 1px solid #ccc; padding:5px;}
button.small { padding: 3px 8px; font-size:14px; margin-left:5px;}
</style>
</head>
<body>

<h2>Libri</h2>

<h3>Cerca libro</h3>
<input id="searchTitle" placeholder="Titolo">
<button onclick="checkBook()">Cerca</button>
<div id="result"></div>

<hr>

<h3>Aggiungi libro</h3>
<input id="newTitle" placeholder="Titolo">
<input id="newAuthor" placeholder="Autore">
<input id="newPublisher" placeholder="Casa editrice (opzionale)">
<button onclick="addBook()">Aggiungi libro</button>

<hr>

<h3>Elenco libri</h3>
<div id="bookList"></div>

<script>
let books = JSON.parse(localStorage.getItem('books') || '{}');

function saveBooks(){ localStorage.setItem('books', JSON.stringify(books)); }

function addBook() {
  const t = document.getElementById("newTitle").value.trim();
  const a = document.getElementById("newAuthor").value.trim();
  const p = document.getElementById("newPublisher").value.trim();
  if(!t||!a){ alert("Titolo e Autore obbligatori!"); return; }
  const id = Date.now().toString();
  books[id] = { title: t, author: a, publisher: p, arrived:false };
  saveBooks();
  renderList();
  document.getElementById("newTitle").value="";
  document.getElementById("newAuthor").value="";
  document.getElementById("newPublisher").value="";
  alert("Libro aggiunto!");
}

function checkBook() {
  const search = document.getElementById("searchTitle").value.trim().toLowerCase();
  const result = document.getElementById("result");
  if(!search){ result.textContent=""; return; }
  const found = Object.values(books).filter(b => b.title.toLowerCase().includes(search));
  if(found.length===0){ result.textContent="Nessun libro trovato ❌"; return; }
  let out = "Libri trovati ✅\n\n";
  found.forEach(b => out+=`Titolo: ${b.title}\nAutore: ${b.author}\n${b.publisher ? "Casa editrice: "+b.publisher+"\n":""}Arrivato: ${b.arrived ? "✅":"❌"}\n\n`);
  result.textContent = out;
}

function toggleArrived(id){
  books[id].arrived = !books[id].arrived;
  saveBooks();
  renderList();
}

function deleteBook(id){
  if(confirm("Vuoi eliminare questo libro?")){
    delete books[id];
    saveBooks();
    renderList();
  }
}

function renderList(){
  const listDiv = document.getElementById("bookList");
  listDiv.innerHTML = "";
  for(let id in books){
    const b = books[id];
    const div = document.createElement("div");
    div.className="bookItem";
    div.innerHTML = `
      ${b.title} — ${b.author} ${b.publisher ? "- " + b.publisher : ""}
      <input type="checkbox" ${b.arrived ? "checked" : ""} onclick="toggleArrived('${id}')"> Arrivato
      <button class="small" onclick="deleteBook('${id}')">Elimina</button>
    `;
    listDiv.appendChild(div);
  }
}

renderList();
</script>

</body>
</html>
