<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Controllo Libri</title>
<style>
    body { font-family: Arial; padding: 20px; }
    input, button { padding: 10px; margin: 5px 0; font-size: 16px; width: 100%; }
    button { background: #007bff; color: white; border: none; border-radius: 8px; }
    button:hover { opacity: 0.8; }
    .book { border: 1px solid #ccc; padding: 10px; margin: 10px 0; border-radius: 8px; }
</style>
</head>
<body>

<h1>üìö Controllo Libri</h1>

<h2>üîç Cerca Libro</h2>
<input type="text" id="searchInput" placeholder="Titolo o autore">
<button onclick="searchBooks()">Cerca</button>
<div id="searchResults"></div>

<hr>

<h2>‚ûï Aggiungi Libro</h2>
<input type="text" id="titleInput" placeholder="Titolo" required>
<input type="text" id="authorInput" placeholder="Autore" required>
<input type="text" id="publisherInput" placeholder="Casa editrice (opzionale)">
<button onclick="addBook()">Aggiungi</button>
<p id="addMessage"></p>

<hr>

<h2>üìñ Lista Completa</h2>
<button onclick="loadBooks()">Mostra Tutti i Libri</button>
<div id="bookList"></div>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyBf-7Tg24C63gEVJEVkAyVqeci_WQ-BL9k",
  authDomain: "controlloordini-165ec.firebaseapp.com",
  projectId: "controlloordini-165ec",
  storageBucket: "controlloordini-165ec.firebasestorage.app",
  messagingSenderId: "825748031202",
  appId: "1:825748031202:web:61cb4cca7511df87a280bb",
  measurementId: "G-F5GR79DLMN"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

window.books = [];

async function loadBooks() {
    const querySnap = await getDocs(collection(db, "books"));
    window.books = [];
    document.getElementById("bookList").innerHTML = "";

    querySnap.forEach(d => {
        let b = d.data();
        b.id = d.id;
        window.books.push(b);
    });

    displayBooks(window.books);
}

function displayBooks(list) {
    const box = document.getElementById("bookList");
    box.innerHTML = "";

    list.forEach(b => {
        box.innerHTML += `
            <div class="book">
                <b>${b.title}</b><br>
                Autore: ${b.author}<br>
                Casa editrice: ${b.publisher || "‚Äî"}<br>
                <button onclick="deleteBook('${b.id}')">Elimina</button>
            </div>
        `;
    });
}

async function deleteBook(id) {
    await deleteDoc(doc(db, "books", id));
    loadBooks();
}

window.addBook = async function () {
    const title = document.getElementById("titleInput").value.trim();
    const author = document.getElementById("authorInput").value.trim();
    const publisher = document.getElementById("publisherInput").value.trim();

    if (!title || !author) {
        document.getElementById("addMessage").innerHTML = "Titolo e autore obbligatori.";
        return;
    }

    await addDoc(collection(db, "books"), {
        title: title,
        author: author,
        publisher: publisher
    });

    document.getElementById("addMessage").innerHTML = "Libro aggiunto!";
    document.getElementById("titleInput").value = "";
    document.getElementById("authorInput").value = "";
    document.getElementById("publisherInput").value = "";

    loadBooks();
};

window.searchBooks = function () {
    const q = document.getElementById("searchInput").value.toLowerCase().trim();
    if (!q) return;

    const found = window.books.filter(b =>
        b.title.toLowerCase().includes(q) ||
        b.author.toLowerCase().includes(q)
    );

    let box = document.getElementById("searchResults");

    if (found.length === 0) {
        box.innerHTML = "<p>‚ùå Non ce l'hai</p>";
        return;
    }

    let html = "<h3>üìö Risultati:</h3>";
    found.forEach(b => {
        html += `
            <div class="book">
                <b>${b.title}</b><br>
                Autore: ${b.author}<br>
                Casa editrice: ${b.publisher || "‚Äî"}
            </div>
        `;
    });

    box.innerHTML = html;
};

// carica all'avvio
loadBooks();
</script>

</body>
</html>
