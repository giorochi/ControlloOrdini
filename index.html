<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Libreria Cloud</title>
<style>
body { font-family: Arial; padding: 20px; text-align:center; }
input, button { width:90%; padding:10px; margin:5px; font-size:18px; border-radius:8px; border:1px solid #888; }
.book { padding:10px; border-bottom: 1px solid #aaa; text-align:left; max-width:500px; margin:auto; }
</style>
</head>
<body>

<h2>Gestione Libri Cloud</h2>

<h3>Cerca libro</h3>
<input id="search" placeholder="Titolo">
<button onclick="searchBook()">Cerca</button>
<div id="results"></div>

<hr>

<h3>Aggiungi libro</h3>
<input id="t" placeholder="Titolo">
<input id="a" placeholder="Autore">
<input id="l" placeholder="Libreria">
<button onclick="addBook()">Aggiungi</button>

<hr>
<h3>Elenco libri</h3>
<div id="list"></div>

<script>
const API = "/api";

async function loadList() {
  const res = await fetch(API + "/list");
  const data = await res.json();
  renderList(data);
  window.booksCache = data;
}

function renderList(books) {
  const div = document.getElementById("list");
  div.innerHTML = "";
  books.forEach(b => {
    div.innerHTML += `
      <div class="book">
        <b>${b.title}</b><br>
        Autore: ${b.author}<br>
        Libreria: ${b.library}<br>
        Arrivato: ${b.arrived ? "✔️" : "❌"}
      </div>
    `;
  });
}

function searchBook() {
  const txt = document.getElementById("search").value.toLowerCase().trim();
  const out = document.getElementById("results");

  if (!txt) {
    out.innerHTML = "";
    return;
  }

  const found = window.booksCache.filter(b =>
    b.title.toLowerCase().includes(txt)
  );

  if (found.length === 0) {
    out.innerHTML = "<p>Nessun libro trovato ❌</p>";
    return;
  }

  out.innerHTML = found.map(b => `
    <div class="book">
      <b>${b.title}</b><br>
      Autore: ${b.author}<br>
      Libreria: ${b.library}<br>
      Arrivato: ${b.arrived ? "✔️" : "❌"}
    </div>
  `).join("");
}

async function addBook() {
  const title = document.getElementById("t").value.trim();
  const author = document.getElementById("a").value.trim();
  const library = document.getElementById("l").value.trim();

  if (!title || !author || !library) {
    alert("Compila tutto, per l'amor del cielo");
    return;
  }

  await fetch(API + "/add", {
    method: "POST",
    body: JSON.stringify({ title, author, library })
  });

  document.getElementById("t").value = "";
  document.getElementById("a").value = "";
  document.getElementById("l").value = "";

  loadList();
}
loadList();
</script>

</body>
</html>
